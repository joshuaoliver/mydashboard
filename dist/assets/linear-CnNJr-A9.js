import{c as y,d,b as I,r as p,j as e,C as m,i as g,k as j,f as h,l as w,m as k,h as f}from"./index-BiTP6UeF.js";import{u as T}from"./useSuspenseQuery-BI5dw9cZ.js";import{B as c}from"./button-RNOw0Kg4.js";import{I as D}from"./input-C8zM_rjF.js";import{L as C}from"./label-BUooFWRZ.js";import{B as N}from"./badge-Djmg-4jD.js";import{S as P}from"./switch-BrP0SaIw.js";import{D as W,a as $,b as _,c as K,d as R,e as E,f as F}from"./dialog-CkvU02Kn.js";import{L as u}from"./layout-list-C8JU_Wy5.js";import{C as O}from"./copy-BYoSSq7T.js";import{E as b}from"./external-link-DQ7xCNxh.js";import{P as v}from"./plus-Duac9OgE.js";import{U}from"./users-D4c1pni6.js";import{C as B}from"./circle-check-oSI9b7XE.js";import{C as H}from"./circle-x-CjqoQCx6.js";import{R as z}from"./refresh-cw-aD6uxtSl.js";import{T as G}from"./trash-2-Cg89AqxP.js";import"./index-eoGaCaxS.js";import"./Combination-DgyOTBSr.js";import"./index-DoJWmL-y.js";import"./index-DDYpCHIR.js";function ge(){const{data:s}=T(y(d.linearActions.listWorkspaces,{})),{data:a}=I(y(d.linearSync.getStats,{})),[x,n]=p.useState(!1),l=typeof window<"u"?`${window.location.origin.replace(".convex.cloud",".convex.site")}/linear-webhook`:"",o=r=>{navigator.clipboard.writeText(r)};return e.jsxs("div",{className:"container mx-auto p-6 max-w-4xl",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(u,{className:"w-8 h-8 text-purple-500"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Linear Integration"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Connect Linear workspaces to track your issues"})]})]})}),a&&a.totalIssues>0&&e.jsxs(m,{className:"mb-6",children:[e.jsx(g,{children:e.jsx(j,{children:"Overview"})}),e.jsxs(h,{children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Total Issues"}),e.jsx("p",{className:"text-lg font-semibold",children:a.totalIssues})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Urgent"}),e.jsx("p",{className:"text-lg font-semibold text-red-600",children:a.byPriority.urgent})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"High Priority"}),e.jsx("p",{className:"text-lg font-semibold text-orange-600",children:a.byPriority.high})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"In Progress"}),e.jsx("p",{className:"text-lg font-semibold text-blue-600",children:a.byStatusType.started})]})]}),a.lastSyncedAt&&e.jsxs("p",{className:"text-xs text-gray-500 mt-4",children:["Last synced: ",new Date(a.lastSyncedAt).toLocaleString()]})]})]}),e.jsxs(m,{className:"mb-6",children:[e.jsxs(g,{children:[e.jsx(j,{children:"Webhook Setup (Optional)"}),e.jsx(w,{children:"Set up a webhook in Linear for real-time updates"})]}),e.jsxs(h,{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"To receive instant updates when issues change, add a webhook in your Linear workspace settings. The dashboard will still sync every 15 minutes without a webhook."}),e.jsxs("div",{children:[e.jsx(C,{className:"text-xs text-gray-500",children:"Webhook URL"}),e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gray-100 rounded mt-1",children:[e.jsx("code",{className:"text-xs flex-1 break-all",children:l}),e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>o(l),children:e.jsx(O,{className:"w-4 h-4"})})]})]}),e.jsxs("a",{href:"https://linear.app/settings/api/webhooks",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 text-sm text-purple-600 hover:underline",children:["Open Linear Webhook Settings ",e.jsx(b,{className:"w-3 h-3"})]})]})]}),e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Workspaces"}),e.jsxs(W,{open:x,onOpenChange:n,children:[e.jsx($,{asChild:!0,children:e.jsxs(c,{children:[e.jsx(v,{className:"w-4 h-4 mr-2"}),"Add Workspace"]})}),e.jsx(M,{onClose:()=>n(!1)})]})]}),s.length===0?e.jsx(m,{children:e.jsxs(h,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(u,{className:"w-12 h-12 text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-600 mb-2",children:"No Linear workspaces connected"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Add a workspace using your Linear API key"}),e.jsxs(c,{onClick:()=>n(!0),children:[e.jsx(v,{className:"w-4 h-4 mr-2"}),"Add Workspace"]})]})}):e.jsx("div",{className:"space-y-4",children:s.map(r=>e.jsx(Q,{workspace:r},r._id))}),e.jsxs(m,{className:"mt-6",children:[e.jsx(g,{children:e.jsx(j,{children:"How to Get Your API Key"})}),e.jsxs(h,{className:"space-y-3 text-sm text-gray-600",children:[e.jsxs("p",{children:["1. Go to"," ",e.jsxs("a",{href:"https://linear.app/settings/api",target:"_blank",rel:"noopener noreferrer",className:"text-purple-600 hover:underline inline-flex items-center gap-1",children:["Linear API Settings ",e.jsx(b,{className:"w-3 h-3"})]})]}),e.jsx("p",{children:'2. Click "Create new API key"'}),e.jsx("p",{children:'3. Give it a name like "My Dashboard" and set the scope to "Read-only"'}),e.jsx("p",{children:"4. Copy the key and paste it above"}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Note: Each workspace requires a separate API key. The key owner determines which user's issues are synced."})]})]})]})}function Q({workspace:s}){const a=f(d.linearActions.deleteWorkspace),x=f(d.linearActions.toggleWorkspaceActive),n=k(d.linearActions.testConnection),[l,o]=p.useState(!1),[r,t]=p.useState(null),A=()=>{confirm(`Delete workspace "${s.workspaceName}"? This will also remove all synced issues.`)&&a({id:s._id}).catch(i=>alert(i.message||"Failed to delete"))},S=()=>{x({id:s._id}).catch(i=>alert(i.message||"Failed to toggle"))},L=async()=>{o(!0),t(null);try{const i=await n({workspaceId:s._id});i.success?t({success:!0,message:`Connected as ${i.userName}. Found ${i.teamCount} team(s).`}):t({success:!1,message:i.error||"Connection failed"})}catch(i){t({success:!1,message:i.message||"Connection test failed"})}finally{o(!1)}};return e.jsxs(m,{className:s.isActive?"":"opacity-60",children:[e.jsxs(g,{className:"flex flex-row items-start justify-between space-y-0 pb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{className:"w-5 h-5 text-purple-600"}),e.jsxs("div",{children:[e.jsx(j,{className:"text-lg font-semibold",children:s.workspaceName}),s.userName&&e.jsxs(w,{className:"flex items-center gap-1",children:[e.jsx(U,{className:"w-3 h-3"}),s.userName]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:s.isActive?e.jsxs(N,{className:"bg-green-100 text-green-800",children:[e.jsx(B,{className:"w-3 h-3 mr-1"}),"Active"]}):e.jsxs(N,{className:"bg-gray-100 text-gray-800",children:[e.jsx(H,{className:"w-3 h-3 mr-1"}),"Inactive"]})})]}),e.jsxs(h,{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between text-sm",children:e.jsx("span",{className:"text-gray-500",children:s.lastSyncedAt?`Last synced: ${new Date(s.lastSyncedAt).toLocaleString()}`:"Never synced"})}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Active"}),e.jsx(P,{checked:s.isActive,onCheckedChange:S})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(c,{variant:"outline",size:"sm",onClick:L,disabled:l,children:[e.jsx(z,{className:`w-4 h-4 mr-1 ${l?"animate-spin":""}`}),"Test"]}),e.jsx(c,{variant:"ghost",size:"sm",onClick:A,className:"text-red-600 hover:text-red-700",children:e.jsx(G,{className:"w-4 h-4"})})]})]}),r&&e.jsx("div",{className:`p-3 rounded-lg text-sm ${r.success?"bg-green-50 text-green-800":"bg-red-50 text-red-800"}`,children:r.message})]})]})}function M({onClose:s}){const[a,x]=p.useState(""),[n,l]=p.useState(!1),o=k(d.linearActions.addWorkspace),r=async()=>{if(!a.trim()){alert("Please enter an API key");return}l(!0);try{const t=await o({apiKey:a.trim()});alert(`Successfully added "${t.workspaceName}" with ${t.teamCount} team(s)!`),s()}catch(t){alert("Failed to add workspace: "+(t.message||"Unknown error"))}finally{l(!1)}};return e.jsxs(_,{children:[e.jsxs(K,{children:[e.jsx(R,{children:"Add Linear Workspace"}),e.jsx(E,{children:"Enter a Linear API key to connect a workspace"})]}),e.jsx("div",{className:"space-y-4 py-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"apiKey",children:"API Key"}),e.jsx(D,{id:"apiKey",placeholder:"lin_api_xxxxxx...",value:a,onChange:t=>x(t.target.value),type:"password"}),e.jsx("p",{className:"text-xs text-gray-500",children:"The workspace and user will be auto-detected from the API key"})]})}),e.jsxs(F,{children:[e.jsx(c,{variant:"outline",onClick:s,disabled:n,children:"Cancel"}),e.jsx(c,{onClick:r,disabled:n||!a.trim(),children:n?"Adding...":"Add Workspace"})]})]})}export{ge as component};
