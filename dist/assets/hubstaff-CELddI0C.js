import{e as Z,c as L,d as o,b as ee,m as f,r as a,j as e,C as u,i as p,k as j,f as N,l as A}from"./index-BiTP6UeF.js";import{u as se}from"./useSuspenseQuery-BI5dw9cZ.js";import{B as y}from"./button-RNOw0Kg4.js";import{I as ae}from"./input-C8zM_rjF.js";import{L as C}from"./label-BUooFWRZ.js";import{B as R}from"./badge-Djmg-4jD.js";import{S as E,a as V,b as B,c as M,d as P}from"./select-cxolFpj3.js";import{C as te}from"./clock-GT_BKR4R.js";import{C as ne}from"./circle-check-oSI9b7XE.js";import{C as re}from"./circle-x-CjqoQCx6.js";import{R as F}from"./refresh-cw-aD6uxtSl.js";import"./index-eoGaCaxS.js";import"./index-BcrQaILI.js";import"./index-DoJWmL-y.js";import"./Combination-DgyOTBSr.js";import"./index-BkrBKZl2.js";import"./chevron-down-DfK4IzMz.js";import"./check-tE-Z_oDg.js";import"./chevron-up-CiPoKxbo.js";const ie=[["path",{d:"M10 12h4",key:"a56b0p"}],["path",{d:"M10 8h4",key:"1sr2af"}],["path",{d:"M14 21v-3a2 2 0 0 0-4 0v3",key:"1rgiei"}],["path",{d:"M6 10H4a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-2",key:"secmi2"}],["path",{d:"M6 21V5a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v16",key:"16ra0t"}]],le=Z("building-2",ie);function ze(){const{data:r}=se(L(o.settingsStore.getHubstaffSettings,{})),{data:b}=ee({...L(o.hubstaffSync.getStats,{}),enabled:!!r?.isConfigured}),v=f(o.hubstaffActions.saveConfiguration),J=f(o.hubstaffActions.testConnection),Q=f(o.hubstaffActions.fetchOrganizations),G=f(o.hubstaffActions.fetchOrganizationUsers),[i,X]=a.useState(r?.refreshToken??""),[t,S]=a.useState(r?.organizationId??null),[c,Y]=a.useState(r?.selectedUserId??null),[k,w]=a.useState(!1),[z,I]=a.useState(!1),[T,U]=a.useState(!1),[g,O]=a.useState(!1),[d,_]=a.useState([]),[m,$]=a.useState([]),[x,h]=a.useState(null),H=r?.isConfigured??!1,D=async()=>{if(!i.trim()){alert("Please enter a refresh token first");return}U(!0);try{await v({refreshToken:i.trim(),organizationId:0});const s=await Q({});_(s.map(n=>({id:n.id,name:n.name}))),s.length===1&&S(s[0].id)}catch(s){alert("Failed to load organizations: "+(s.message||"Unknown error"))}finally{U(!1)}};a.useEffect(()=>{t&&i&&K(t)},[t]);const K=async s=>{O(!0);try{const n=await G({organizationId:s});$(n.map(l=>({id:l.id,name:l.name})))}catch(n){console.error("Failed to load users:",n)}finally{O(!1)}},q=async()=>{if(!i.trim()){alert("Please enter a refresh token");return}if(!t){alert("Please select an organization");return}if(!c){alert("Please select a user to track");return}w(!0);try{const s=d.find(l=>l.id===t),n=m.find(l=>l.id===c);await v({refreshToken:i.trim(),organizationId:t,organizationName:s?.name,selectedUserId:c,selectedUserName:n?.name}),alert("Configuration saved successfully!"),window.location.reload()}catch(s){alert("Failed to save: "+(s.message||"Unknown error"))}finally{w(!1)}},W=async()=>{I(!0),h(null);try{const s=await J({});s.success?h({success:!0,message:s.message||"Connected successfully!"}):h({success:!1,message:s.error||"Connection failed"})}catch(s){h({success:!1,message:s.message||"Connection test failed"})}finally{I(!1)}};return e.jsxs("div",{className:"container mx-auto p-6 max-w-4xl",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(te,{className:"w-8 h-8 text-green-500"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Hubstaff Integration"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Connect Hubstaff to track your time entries"})]})]})}),e.jsxs(u,{className:"mb-6",children:[e.jsx(p,{children:e.jsxs(j,{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Connection Status"}),H?e.jsxs(R,{className:"bg-green-100 text-green-800",children:[e.jsx(ne,{className:"w-4 h-4 mr-1"}),"Connected"]}):e.jsxs(R,{className:"bg-gray-100 text-gray-800",children:[e.jsx(re,{className:"w-4 h-4 mr-1"}),"Not Configured"]})]})}),H&&e.jsxs(N,{children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Organization"}),e.jsx("p",{className:"text-lg font-semibold",children:r?.organizationName||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Tracking User"}),e.jsx("p",{className:"text-lg font-semibold",children:r?.selectedUserName||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Total Entries"}),e.jsx("p",{className:"text-lg font-semibold",children:b?.totalEntries??0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Total Hours"}),e.jsxs("p",{className:"text-lg font-semibold",children:[b?.totalHoursAllTime??0,"h"]})]})]}),e.jsx("div",{className:"mt-4 flex gap-2",children:e.jsxs(y,{variant:"outline",size:"sm",onClick:W,disabled:z,children:[e.jsx(F,{className:`w-4 h-4 mr-2 ${z?"animate-spin":""}`}),"Test Connection"]})}),x&&e.jsx("div",{className:`mt-3 p-3 rounded-lg ${x.success?"bg-green-50 text-green-800":"bg-red-50 text-red-800"}`,children:x.message})]})]}),e.jsxs(u,{className:"mb-6",children:[e.jsxs(p,{children:[e.jsx(j,{children:"Setup Instructions"}),e.jsx(A,{children:"You'll need a Hubstaff refresh token to connect"})]}),e.jsx(N,{className:"space-y-4",children:e.jsxs("div",{className:"p-4 bg-yellow-50 rounded-lg text-sm text-yellow-800",children:[e.jsx("p",{className:"font-medium mb-2",children:"Getting your Refresh Token:"}),e.jsx("p",{children:"The refresh token is reused from your existing Hubstaff integration in transdirect-pm. You can find it in the config.json file of that project, or generate a new one through Hubstaff's OAuth flow."})]})})]}),e.jsxs(u,{className:"mb-6",children:[e.jsxs(p,{children:[e.jsx(j,{children:"Configuration"}),e.jsx(A,{children:"Enter your Hubstaff credentials and select which user to track"})]}),e.jsxs(N,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"refreshToken",children:"Refresh Token"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ae,{id:"refreshToken",placeholder:"eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIs...",value:i,onChange:s=>X(s.target.value),type:"password",className:"flex-1"}),e.jsxs(y,{variant:"outline",onClick:D,disabled:T||!i.trim(),children:[T?e.jsx(F,{className:"w-4 h-4 animate-spin"}):e.jsx(le,{className:"w-4 h-4"}),e.jsx("span",{className:"ml-2",children:"Load Orgs"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{children:"Organization"}),e.jsxs(E,{value:t?.toString()??"",onValueChange:s=>S(parseInt(s)),disabled:d.length===0,children:[e.jsx(V,{children:e.jsx(B,{placeholder:"Select an organization..."})}),e.jsx(M,{children:d.map(s=>e.jsx(P,{value:s.id.toString(),children:s.name},s.id))})]}),d.length===0&&e.jsx("p",{className:"text-xs text-gray-500",children:'Enter your refresh token and click "Load Orgs" to see organizations'})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{children:"User to Track"}),e.jsxs(E,{value:c?.toString()??"",onValueChange:s=>Y(parseInt(s)),disabled:m.length===0||g,children:[e.jsx(V,{children:e.jsx(B,{placeholder:g?"Loading users...":"Select a user..."})}),e.jsx(M,{children:m.map(s=>e.jsx(P,{value:s.id.toString(),children:s.name},s.id))})]}),m.length===0&&t&&!g&&e.jsx("p",{className:"text-xs text-gray-500",children:"No users found in this organization"})]}),e.jsx("div",{className:"flex gap-2 pt-4",children:e.jsx(y,{onClick:q,disabled:k||!c,children:k?"Saving...":"Save Configuration"})})]})]})]})}export{ze as component};
