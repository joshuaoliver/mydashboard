import{r as u,j as t,B as $,z as F,p as k,g as N,c as K,d as A,h as O,D as H,K as U,E as B,F as Q,G as z,H as q}from"./index-BiTP6UeF.js";import{u as G}from"./useSuspenseQuery-BI5dw9cZ.js";import{P as V}from"./page-header-wTyQHiqG.js";import{P as w}from"./label-BUooFWRZ.js";import{S as W,a as J,b as X,c as Y}from"./sheet-Bifj_UwF.js";import{C as Z}from"./ContactPanel-DJBmzfMv.js";import"./index-eoGaCaxS.js";import"./Combination-DgyOTBSr.js";import"./index-BcrQaILI.js";import"./index-DoJWmL-y.js";import"./index-DDYpCHIR.js";import"./button-RNOw0Kg4.js";import"./textarea-YkGIn2mW.js";import"./switch-BrP0SaIw.js";import"./badge-Djmg-4jD.js";import"./input-C8zM_rjF.js";import"./search-BcZJC1hW.js";import"./dialog-CkvU02Kn.js";import"./circle-alert-c2HjJ2Ls.js";import"./instagram-arD0XV9m.js";import"./phone-D1osf1s3.js";import"./user-iDHg6gyw.js";import"./check-tE-Z_oDg.js";function ee(e,r=[]){let i=[];function m(a,l){const o=u.createContext(l);o.displayName=a+"Context";const d=i.length;i=[...i,l];const f=v=>{const{scope:j,children:C,...b}=v,s=j?.[e]?.[d]||o,x=u.useMemo(()=>b,Object.values(b));return t.jsx(s.Provider,{value:x,children:C})};f.displayName=a+"Provider";function g(v,j){const C=j?.[e]?.[d]||o,b=u.useContext(C);if(b)return b;if(l!==void 0)return l;throw new Error(`\`${v}\` must be used within \`${a}\``)}return[f,g]}const c=()=>{const a=i.map(l=>u.createContext(l));return function(o){const d=o?.[e]||a;return u.useMemo(()=>({[`__scope${e}`]:{...o,[e]:d}}),[o,d])}};return c.scopeName=e,[m,te(c,...r)]}function te(...e){const r=e[0];if(e.length===1)return r;const i=()=>{const m=e.map(c=>({useScope:c(),scopeName:c.scopeName}));return function(a){const l=m.reduce((o,{useScope:d,scopeName:f})=>{const v=d(a)[`__scope${f}`];return{...o,...v}},{});return u.useMemo(()=>({[`__scope${r.scopeName}`]:l}),[l])}};return i.scopeName=r.scopeName,i}var ae=$();function ne(){return ae.useSyncExternalStore(re,()=>!0,()=>!1)}function re(){return()=>{}}var L="Avatar",[se]=ee(L),[oe,_]=se(L),P=u.forwardRef((e,r)=>{const{__scopeAvatar:i,...m}=e,[c,a]=u.useState("idle");return t.jsx(oe,{scope:i,imageLoadingStatus:c,onImageLoadingStatusChange:a,children:t.jsx(w.span,{...m,ref:r})})});P.displayName=L;var M="AvatarImage",D=u.forwardRef((e,r)=>{const{__scopeAvatar:i,src:m,onLoadingStatusChange:c=()=>{},...a}=e,l=_(M,i),o=ie(m,a),d=F(f=>{c(f),l.onImageLoadingStatusChange(f)});return k(()=>{o!=="idle"&&d(o)},[o,d]),o==="loaded"?t.jsx(w.img,{...a,ref:r,src:m}):null});D.displayName=M;var T="AvatarFallback",R=u.forwardRef((e,r)=>{const{__scopeAvatar:i,delayMs:m,...c}=e,a=_(T,i),[l,o]=u.useState(m===void 0);return u.useEffect(()=>{if(m!==void 0){const d=window.setTimeout(()=>o(!0),m);return()=>window.clearTimeout(d)}},[m]),l&&a.imageLoadingStatus!=="loaded"?t.jsx(w.span,{...c,ref:r}):null});R.displayName=T;function I(e,r){return e?r?(e.src!==r&&(e.src=r),e.complete&&e.naturalWidth>0?"loaded":"loading"):"error":"idle"}function ie(e,{referrerPolicy:r,crossOrigin:i}){const m=ne(),c=u.useRef(null),a=m?(c.current||(c.current=new window.Image),c.current):null,[l,o]=u.useState(()=>I(a,e));return k(()=>{o(I(a,e))},[a,e]),k(()=>{const d=v=>()=>{o(v)};if(!a)return;const f=d("loaded"),g=d("error");return a.addEventListener("load",f),a.addEventListener("error",g),r&&(a.referrerPolicy=r),typeof i=="string"&&(a.crossOrigin=i),()=>{a.removeEventListener("load",f),a.removeEventListener("error",g)}},[a,i,r]),l}var ce=P,le=D,de=R;function ue({className:e,...r}){return t.jsx(ce,{"data-slot":"avatar",className:N("relative flex size-8 shrink-0 overflow-hidden rounded-full",e),...r})}function me({className:e,...r}){return t.jsx(le,{"data-slot":"avatar-image",className:N("aspect-square size-full",e),...r})}function fe({className:e,...r}){return t.jsx(de,{"data-slot":"avatar-fallback",className:N("bg-muted flex size-full items-center justify-center rounded-full",e),...r})}const S=[{id:"Talking",name:"Talking",key:"Talking",label:"Talking",accent:"bg-sky-100 text-sky-700",border:"border-sky-200"},{id:"Planning",name:"Planning",key:"Planning",label:"Planning",accent:"bg-amber-100 text-amber-700",border:"border-amber-200"},{id:"Dated",name:"Drinks",key:"Dated",label:"Drinks",accent:"bg-rose-100 text-rose-700",border:"border-rose-200"},{id:"Connected",name:"Connected",key:"Connected",label:"Connected",accent:"bg-emerald-100 text-emerald-700",border:"border-emerald-200"},{id:"Former",name:"Former",key:"Former",label:"Former",accent:"bg-slate-200 text-slate-700",border:"border-slate-300"},{id:"NoStatus",name:"Unassigned",key:"NoStatus",label:"Unassigned",accent:"bg-gray-100 text-gray-700",border:"border-gray-200"}];function Ke(){const[e,r]=u.useState(null),[i,m]=u.useState(!1),[c,a]=u.useState(null),{data:l}=G(K(A.dexQueries.listContacts,{limit:1e3})),o=O(A.contactMutations.updateLeadStatus),d=u.useMemo(()=>{const s=new Set(["romantic","romatic"]);return l.contacts.filter(x=>x.connections?.some(n=>s.has(n.toLowerCase()))).sort((x,n)=>(n.lastModifiedAt??0)-(x.lastModifiedAt??0))},[l.contacts]),f=u.useMemo(()=>d.map(s=>{const x=s.leadStatus||"NoStatus",n=S.find(p=>p.key===x);return{id:s._id,name:xe(s),column:n?.id??"NoStatus",contact:s}}),[d]),g=H(A.dexQueries.getContactById,e?{contactId:e}:"skip"),v=s=>{r(s),m(!0)},j=()=>{m(!1),r(null)},C=s=>{if(!s.over){a(null);return}const x=S.find(p=>p.id===s.over.id);if(x){a(x.id);return}const n=f.find(p=>p.id===s.over.id);n&&a(n.column)},b=s=>{const{active:x,over:n}=s;if(!n||x.id===n.id){a(null);return}let p=S.find(h=>h.id===n.id);if(!p){const h=f.find(y=>y.id===n.id);h&&(p=S.find(y=>y.id===h.column))}if(!p&&c&&(p=S.find(h=>h.id===c)),!p){a(null);return}const E=f.find(h=>h.id===x.id);if(E&&E.column===p.id){a(null);return}o({contactId:x.id,leadStatus:p.key==="NoStatus"?null:p.key}),a(null)};return t.jsxs("div",{className:"flex h-full flex-col overflow-hidden",children:[t.jsx("div",{className:"px-6 py-6",children:t.jsx(V,{title:"Sales",description:"Keep tabs on romantic leads and progress them through each stage."})}),t.jsx("div",{className:"flex-1 overflow-auto px-6 pb-8",children:d.length===0?t.jsxs("div",{className:"flex h-full flex-col items-center justify-center rounded-lg border border-dashed border-slate-200 bg-white py-16 text-center",children:[t.jsx("p",{className:"text-lg font-semibold text-slate-900",children:"No romantic contacts yet"}),t.jsx("p",{className:"text-sm text-slate-600",children:"Assign the Romantic connection type to a contact."})]}):t.jsx("div",{className:"h-full min-h-[600px]",children:t.jsx(U,{columns:S,data:f,onDragEnd:b,onDragOver:C,children:s=>{const x=f.filter(n=>n.column===s.id);return t.jsxs(B,{id:s.id,children:[t.jsx(Q,{className:N("flex items-center justify-between border-b px-4 py-3",s.border),children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-sm font-semibold text-slate-900",children:s.label}),t.jsx("span",{className:"rounded-full bg-slate-100 px-2 py-0.5 text-xs font-medium text-slate-600",children:x.length})]})}),t.jsx(z,{id:s.id,children:n=>t.jsx(q,{column:s.id,id:n.id,name:n.name,className:"cursor-pointer",onClick:()=>v(n.contact._id),children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsxs(ue,{className:"h-10 w-10 flex-shrink-0",children:[n.contact.imageUrl&&t.jsx(me,{src:n.contact.imageUrl,alt:n.name}),t.jsx(fe,{children:pe(n.contact.firstName,n.contact.lastName)})]}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"text-sm font-semibold text-slate-900",children:n.name}),(n.contact.objective||n.contact.description||n.contact.notes)&&t.jsx("p",{className:"text-xs text-slate-600 line-clamp-2 mt-1",children:n.contact.objective||n.contact.description||n.contact.notes})]})]})})})]},s.id)}})})}),t.jsx(W,{open:i,onOpenChange:s=>!s&&j(),children:t.jsxs(J,{side:"right",className:"flex h-full w-full flex-col gap-0 overflow-hidden px-0 pb-0 sm:max-w-3xl",children:[t.jsx(X,{className:"border-b px-6 py-4 text-left",children:t.jsx(Y,{className:"text-lg font-semibold text-slate-900",children:"Contact Details"})}),t.jsx("div",{className:"flex-1 overflow-auto px-6 pb-6",children:t.jsx(Z,{contact:g??null,isLoading:g===void 0&&e!==null},g?._id??"empty")})]})})]})}function xe(e){return e.instagram?`@${e.instagram}`:e.firstName||e.lastName?[e.firstName,e.lastName].filter(Boolean).join(" "):"Unnamed contact"}function pe(e,r){return`${e?.[0]??""}${r?.[0]??""}`.toUpperCase()||"??"}export{Ke as component};
